<!DOCTYPE html>
<html>
<head>
	<meta charset="utf-8">
	<meta http-equiv="X-UA-Compatible" content="IE=edge">
	<title>宵街映写 -プロジェクションナイト- 2019</title>
	<style>
		*{ margin: 0; padding: 0; box-sizing: border-box; }
		body { font: 13px Helvetica, Arial; }
		form { background: #000; padding: 3px; position: fixed; bottom: 0; width: 100%;}
		form input { border: 0; padding: 10px; width: 90%; margin-right: .5%;}
		form button { width: 9%; background: rgb(130, 224, 255); border: none; padding: 10px;}
		#js-messages { list-style-type: none; margin: 0; padding: 0;}
		#js-messages li { padding: 5px 10px;}
		#js-messages li:nth-child(odd) { background: #eee;}
		#js-messages { margin-bottom: 40px}
	</style>
	<script src="https://cdnjs.cloudflare.com/ajax/libs/socket.io/2.2.0/socket.io.js"></script>
	<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
	<script>
		const COLORS = {
			sameVote: 0,
			red: 1,
			yellow: 2,
			blue: 3,
			green: 4,
			orange: 5,
			purple: 6,
			white: 7,
			black: 8
		};

		$(function() {
			const socket = io();
			const $form = $('#js-form');
			const $sendMessage = $('#js-send-message');
			const $messages = $('#js-messages');

			// 投票内容を表示する要素を取得する
			const $log = $('#js-log')

			$form.submit((e) => {
				e.preventDefault();
				const message = $sendMessage.val();
				console.log(message); 
				socket.emit('chat message', message);
				$sendMessage.val('');
			});



			socket.on('chat message', (msg) => {
				$messages.append($('<li>' + msg + '</li>'));
				window.scrollTo(0, document.body.scrollHeight);
			});

			socket.on('/api/start', (data) => {
				// スマホの画面を開始画面に切り替える
				console.log('サーバーからWebSocketで/api/startのデータを受信しました。')
				console.log(data);
			});

			// 投票１
			socket.on('/api/vote/start/1',(data) => {
				console.log('サーバーからWebSocketで/api/vote/start/1のデータを受け取る')
				const voteColor0 = data.randomVoteColorId[0];
				const voteColor1 = data.randomVoteColorId[1];

				if (voteColor0 === COLORS.red && voteColor1 === COLORS.yellow) {
					console.log('赤と黄の投票画面を表示');
				} else if (voteColor0 === COLORS.red && voteColor1 === COLORS.blue) {
					console.log('赤と青の投票画面を表示');
				} else if (voteColor0 === COLORS.yellow && voteColor1 === COLORS.blue) {
					console.log('黄と青の投票画面を表示');
				}
			})

			// 投票２
			socket.on('/api/vote/start/2',(data) => {
				console.log('サーバーからWebSocketで/api/vote/start/2のデータを受け取る')
				console.log(data);
				console.log('赤と黄と青の投票画面を表示')
			})

			socket.on('/api/scene/change/:id', (data) => {
				// スマホの画面のアニメーションを切り替える
				console.log('サーバーからWebSocketで/api/scene/change/:idのデータを受信しました。')
				console.log(data);

				if(data.sceneId === "0") {
					document.body.style.backgroundColor = "red";
				} else if(data.sceneId === "1") {
					document.body.style.backgroundColor = "blue";
				} else if(data.sceneId === "2") {
					document.body.style.backgroundColor = "green";
				}
			});

			socket.on('/api/end', (data) => {
				// スマホの画面を終了画面に切り替える
				console.log('サーバーからWebSocketで/api/endのデータを受信しました。')
				console.log(data);
			});

			socket.on('vote', (data) => {
				// スマホの画面を終了画面に切り替える
				console.log('サーバーからWebSocketでvoteのデータを受信しました。')
				console.log(data);
			});

		// 投票
		var p1 = document.getElementById('red');
		var handler1 = function(){
			console.log('vote1');
			$log.text('赤に投票しました');
			socket.emit('vote', 'red');
		};
		p1.addEventListener('click', handler1, false);

		var p2 = document.getElementById('yellow');
		var handler2 = function(){
			console.log('vote2');
			$log.text('黄に投票しました');
			socket.emit('vote', 'yellow');
		};
		p2.addEventListener('click', handler2, false);

		var p3 = document.getElementById('blue');
		var handler3 = function(){
			console.log('vote3');
			$log.text('青に投票しました');
			socket.emit('vote', 'blue');
		};
		p3.addEventListener('click', handler3, false);

		var p4 = document.getElementById('white');
		var handler4 = function(){
			console.log('vote4');
			$log.text('白に投票しました');
			socket.emit('vote', 'white');
		};
		p4.addEventListener('click', handler4, false);

		var p5 = document.getElementById('black');
		var handler5 = function(){
			console.log('vote5');
			$log.text('黒に投票しました');
			socket.emit('vote', 'black');
		};
		p5.addEventListener('click', handler5, false);

		});


	</script>
</head>

<body>
	<ul id="js-messages"><!-- 送受信したメッセージがここに入ります。--></ul>
	<form id="js-form" action="">
		<input id="js-send-message" autocomplete="off" /><button>送信</button>
	</form>

	<div id="js-log"><!-- ここに投票内容が出ます --></div>

	<p id="red">red</p>
	<p id="yellow">yellow</p>
	<p id="blue">blue</p>
	<p id="white">white</p>
	<p id="black">black</p>

</body>
</html>